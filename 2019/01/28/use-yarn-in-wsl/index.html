<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>在WSL中使用NPM和yarn | 凌轩的个人主页</title><link rel="shortcut icon" type="image/png" href="https://sinacloud.net/lingxuan-cdn/blog-statics/imgage/logo.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="对于习惯使用 Linux 运行程序，但是开发时候喜欢 windows 的程序员来讲，WSL 是最好的选择了。奈何 WSL 有很多 bug，经常会出现一些奇怪的事情，百思不得其解的时候发现问题还是在 WSL 中，例如，在 1709 版本中使用 npm 或者 yarn 安装包依赖时，会出现各种问题"><meta name="keywords" content="凌轩的个人主页"><meta property="og:type" content="article"><meta property="og:title" content="在WSL中使用NPM和yarn"><meta property="og:url" content="https://lingxuan630.github.io/2019/01/28/use-yarn-in-wsl/index.html"><meta property="og:site_name" content="凌轩的个人主页"><meta property="og:description" content="对于习惯使用 Linux 运行程序，但是开发时候喜欢 windows 的程序员来讲，WSL 是最好的选择了。奈何 WSL 有很多 bug，经常会出现一些奇怪的事情，百思不得其解的时候发现问题还是在 WSL 中，例如，在 1709 版本中使用 npm 或者 yarn 安装包依赖时，会出现各种问题"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-02-03T03:20:14.811Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="在WSL中使用NPM和yarn"><meta name="twitter:description" content="对于习惯使用 Linux 运行程序，但是开发时候喜欢 windows 的程序员来讲，WSL 是最好的选择了。奈何 WSL 有很多 bug，经常会出现一些奇怪的事情，百思不得其解的时候发现问题还是在 WSL 中，例如，在 1709 版本中使用 npm 或者 yarn 安装包依赖时，会出现各种问题"><link rel="stylesheet" href="/home/css/style.css"></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-title" class="inner"><h1 id="title-wrap"><a href="/home/" id="title-box"><span>凌轩的个人主页</span> <span href="/home/" id="subtitle">Dream to escape from the steel forest</span></a></h1></div><div id="header-outer" class="outer"><div id="logo-wrap"><a href="/home/" id="logo">凌轩</a></div><div id="nav-wrap"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/home/"><span>首页</span><br><span class="main-nav-link-alias">INDEX</span> </a><a class="main-nav-link" href="/home/tech"><span>技术</span><br><span class="main-nav-link-alias">TECH</span> </a><a class="main-nav-link" href="/home/travel"><span>行·思</span><br><span class="main-nav-link-alias">TRAVEL</span> </a><a class="main-nav-link" href="/home/read"><span>读书</span><br><span class="main-nav-link-alias">READ</span> </a><a class="main-nav-link" href="/home/prose"><span>杂记</span><br><span class="main-nav-link-alias">PROSE</span></a></nav><nav id="sub-nav"><a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lingxuan630.github.io"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-use-yarn-in-wsl" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/home/2019/01/28/use-yarn-in-wsl/" class="article-date"><time datetime="2019-01-28T05:13:28.000Z" itemprop="datePublished">2019-01-28</time></a><div class="article-category"><a class="article-category-link" href="/home/categories/tech/">tech</a></div></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">在WSL中使用NPM和yarn</h1></header><div class="article-entry" itemprop="articleBody"><p>对于习惯使用 Linux 运行程序，但是开发时候喜欢 windows 的程序员来讲，WSL 是最好的选择了。奈何 WSL 有很多 bug，经常会出现一些奇怪的事情，百思不得其解的时候发现问题还是在 WSL 中，例如，在 1709 版本中使用 npm 或者 yarn 安装包依赖时，会出现各种问题</p><a id="more"></a><p>从 Windows 10 1709 版本开始，WSL(Windows Subsystem for Linux)已经成为自带的功能，具体安装方式可以参考<a href="https://juejin.im/entry/59ed49ca6fb9a0450c488f44" target="_blank" rel="noopener">Windows Subsystem for Linux 环境配置 (最新 1709 版)</a>。</p><p>对于习惯使用 Linux 运行程序，但是开发时候喜欢 windows 的程序员来讲，WSL 是最好的选择了。奈何 WSL 有很多 bug，经常会出现一些奇怪的事情，百思不得其解的时候发现问题还是在 WSL 中，例如，在 1709 版本中使用 npm 或者 yarn 安装包依赖时，会出现各种问题：例如在 yarn 中，出现了一下的问题：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yarn</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">error An unexpected error occurred: &quot;EINVAL: invalid argument, lstat &apos;/mnt/c/Users/duybui/code/web/old/node_modules/accord/node_modules/cliui/README.md&apos;&quot;.</span><br><span class="line">info If you think this is a bug, please open a bug report with the information provided in &quot;/mnt/c/Users/duybui/code/web/old/yarn-error.log&quot;.</span><br><span class="line">info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.</span><br></pre></td></tr></table></figure><p>从上面的错误日志中可以发现一个<code>EINVAL: invalid argument, lstat</code>错误，这个错误是什么意思？首先我们查看一下<code>lstat</code>命令是干嘛用的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">These functions return information about a file. No permissions are required on the file itself, but-in the case of stat() and lstat() - execute (search) permission is required on all of the directories in path that lead to the file.</span><br><span class="line"></span><br><span class="line">from: https://linux.die.net/man/2/lstat</span><br></pre></td></tr></table></figure><p>从上面的描述来看，这是一个文件系统的错误，获取文件信息的时候出错了。</p><p>为什么会出现文件系统级别的错误？？？？？？？？？？？</p><p>微软的程序员出来解释说：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hi all. I&apos;ve been pinged several times over the last 48 hours for an update on the fix for this issue.</span><br><span class="line"></span><br><span class="line">Know that we appreciate and understand the enthusiasm for the fix for this issue, but we do ask for your patience as the fix makes its way up through our build and test systems, on its way to the Insider rings.</span><br><span class="line"></span><br><span class="line">As @SvenGroot stated above, the fix has been checked in but it didn&apos;t make it up to the Insider release branch in time for 17025 which was released on 11/1. It&apos;s v. likely it&apos;ll arrive in the next Insider build.</span><br><span class="line"></span><br><span class="line">Sven is also working to backport this fix to Fall Creators Update (FCU), but since this isn&apos;t a fix for a major security exploit, it&apos;ll make its way through our normal servicing channels, passing through numerous review and testing gates before it&apos;s formally released in an up-coming servicing release.</span><br><span class="line"></span><br><span class="line">Please note...</span><br></pre></td></tr></table></figure><p>讲了一大堆，其实就是说：“我们已经知道这个错误了，但是短期内不会马上修复，请关注我们的进度。” 真是令人失望，连问题的根本原因也没有告诉我们。</p><p>不过热心的网友还是提供了一个奇妙的方法：在<code>~/.bashrc</code>中增加如下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Workaround for issue: https://github.com/Microsoft/WSL/issues/2448</span><br><span class="line">if ! mount | grep -q &quot;C: on /mnt/c type drvfs (rw,noatime,fallback=1)&quot;; then</span><br><span class="line">        echo &quot;== Remount of C: drive required ==&quot;</span><br><span class="line">        pushd ~ &gt; /dev/null</span><br><span class="line">        sudo umount /mnt/c</span><br><span class="line">        sudo mount -t drvfs -o noatime,fallback=1 C: /mnt/c</span><br><span class="line">        popd &gt; /dev/null</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>从上面的代码来看，就是 umount 了 C 盘，然后重新 Mount 上去，只是增加了一些参数：首先是<code>drvfs</code>微软的一篇博客对它进行了比较详细的讲解：<a href="https://blogs.msdn.microsoft.com/wsl/2017/04/18/file-system-improvements-to-the-windows-subsystem-for-linux/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/wsl/2017/04/18/file-system-improvements-to-the-windows-subsystem-for-linux/</a></p><p>而<code>-o noatime</code>是提高文件系统性能的一个参数，禁止记录最近一次访问时间戳，至于<code>fallback=1</code>就不太理解了。</p><p>验证过上面的方法确实有效，不过最终解决问题还是要等微软更新版本。</p></div><footer class="article-footer"><div id="vcomments"></div><a data-url="https://lingxuan630.github.io/2019/01/28/use-yarn-in-wsl/" data-id="cjrocdqrh0001pmjm3f5yriad" class="article-share-link">Share</a></footer></div><nav id="article-nav"><a href="/home/2019/01/28/suggestion-for-toLocaleDateString/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">关于toLocaleDateString的坑</div></a><a href="/home/2019/01/28/why-should-not-use-bind-in-react-jsx/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">在react jsx中，为什么使用箭头函数和bind容易出现问题</div></a></nav></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">分类</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/home/categories/tech/">tech</a></li><li class="category-list-item"><a class="category-list-link" href="/home/categories/travel/">travel</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/home/archives/2019/01/">一月 2019</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">最新文章</h3><div class="widget"><ul><li><a href="/home/2019/02/11/wuzhen-trip/">乌镇·丁香</a></li><li><a href="/home/2019/01/28/suggestion-for-toLocaleDateString/">关于toLocaleDateString的坑</a></li><li><a href="/home/2019/01/28/use-yarn-in-wsl/">在WSL中使用NPM和yarn</a></li><li><a href="/home/2019/01/28/why-should-not-use-bind-in-react-jsx/">在react jsx中，为什么使用箭头函数和bind容易出现问题</a></li><li><a href="/home/2019/01/18/shang-chuan-dao/">上川岛的海边</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2019 linson<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div></div></footer></div><nav id="mobile-nav"><a href="/home/" class="mobile-nav-link">首页</a> <a href="/home/tech" class="mobile-nav-link">技术</a> <a href="/home/travel" class="mobile-nav-link">行·思</a> <a href="/home/read" class="mobile-nav-link">读书</a> <a href="/home/prose" class="mobile-nav-link">杂记</a></nav><script src="https://sinacloud.net/lingxuan-cdn/blog-statics/js/jquery.min.js"></script><link rel="stylesheet" href="https://sinacloud.net/lingxuan-cdn/blog-statics/js/jquery.fancybox.css"><script src="https://sinacloud.net/lingxuan-cdn/blog-statics/js/jquery.fancybox.pack.js"></script><script src="https://sinacloud.net/lingxuan-cdn/blog-statics/js/script.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"uN75AjQedJnWBMk5nWIIrl0K-gzGzoHsz",appKey:"NlY94tut96qbLWLSvnXpRArk"})</script></div></body>